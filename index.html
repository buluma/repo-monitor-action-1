<!DOCTYPE html>
<html>
  <head>
    <title>Metrics</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@1.6.0/dist/tailwind.min.css"
      integrity="sha256-Y4vGjLmrpriLD3X1h1YdyzE2icdiBsJHBXORYXlyDwM="
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/dayjs@1.8.31/dayjs.min.js"
      integrity="sha256-ORgF0pKrTKxau29bikHxGniNlpQtd9Ku1vbl5/m+mJE="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/dayjs@1.8.31/plugin/relativeTime.js"
      integrity="sha256-tMJ/JI74gvcd/JCL4zekEwHfyHfT2XKUd5GAZn6fJOU="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"
      integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI="
      crossorigin="anonymous"
    ></script>
    <script>
      dayjs.extend(window.dayjs_plugin_relativeTime);

      const displayReleases = async (url) => {
        const res = await fetch(
          `https://floric.github.io/repo-monitor-action/data/releases/${new Date().getFullYear()}/releases.json`
        );
        const parsed = await res.json();
        document.getElementById("header-year").innerText = `${parsed.year}`;
        document.getElementById(
          "tbl-releases-body"
        ).innerHTML = parsed.releases.map(
          (n, i) =>
            `<tr class="${i % 2 == 0 ? "bg-gray-200" : "bg-gray-300"}">
              <td class="px-4 py-2">${i + 1}</td>
              <td class="px-4 py-2">${dayjs(n.timestamp).fromNow()}</td>
              <td class="px-4 py-2">${n.id}</td>
            </tr>`
        );
      };

      displayReleases();
    </script>
  </head>
  <body class="bg-gray-100">
    <div class="flex m-4 justify-center">
      <div class="w-full max-w-6xl">
        <h1 id="header-year" class="text-6xl mb-2">-</h1>
        <h2 class="text-xl mb-2 font-bold">Releases</h2>
        <ul id="releases"></ul>
        <table class="table-auto w-full text-left">
          <thead>
            <tr class="bg-gray-800 text-gray-100">
              <th class="px-4 py-2">#</th>
              <th class="px-4 py-2">Date</th>
              <th class="px-4 py-2">Commit</th>
            </tr>
          </thead>
          <tbody id="tbl-releases-body"></tbody>
        </table>
      </div>
    </div>
  </body>
</html>
